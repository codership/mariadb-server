connection node_2;
connection node_1;
connect node_3, 127.0.0.1, root, , test, $NODE_MYPORT_3;
connect node_4, 127.0.0.1, root, , test, $NODE_MYPORT_4;
connection node_2;
call mtr.add_suppression("WSREP: Ignoring server id for non bootstrap node.");
connection node_4;
call mtr.add_suppression("WSREP: Ignoring server id for non bootstrap node.");
connection node_3;
CHANGE MASTER TO master_host='127.0.0.1', master_user='root', master_port=NODE_MYPORT_1, master_use_gtid=current_pos;;
START SLAVE;
include/wait_for_slave_to_start.inc
connection node_1;
CREATE TABLE t1 (id bigint primary key auto_increment, msg varchar(100)) engine=innodb;
INSERT INTO t1 SELECT NULL, md5(rand());
INSERT INTO t1 SELECT NULL, md5(rand()) from t1 LIMIT 1000000;
INSERT INTO t1 SELECT NULL, md5(rand()) from t1 LIMIT 1000000;
INSERT INTO t1 SELECT NULL, md5(rand()) from t1 LIMIT 1000000;
INSERT INTO t1 SELECT NULL, md5(rand()) from t1 LIMIT 1000000;
INSERT INTO t1 SELECT NULL, md5(rand()) from t1 LIMIT 1000000;
INSERT INTO t1 SELECT NULL, md5(rand()) from t1 LIMIT 1000000;
INSERT INTO t1 SELECT NULL, md5(rand()) from t1 LIMIT 1000000;
INSERT INTO t1 SELECT NULL, md5(rand()) from t1 LIMIT 1000000;
INSERT INTO t1 SELECT NULL, md5(rand()) from t1 LIMIT 1000000;
INSERT INTO t1 SELECT NULL, md5(rand()) from t1 LIMIT 1000000;
INSERT INTO t1 SELECT NULL, md5(rand()) from t1 LIMIT 1000000;
INSERT INTO t1 SELECT NULL, md5(rand()) from t1 LIMIT 1000000;
INSERT INTO t1 SELECT NULL, md5(rand()) from t1 LIMIT 1000000;
INSERT INTO t1 SELECT NULL, md5(rand()) from t1 LIMIT 1000000;
INSERT INTO t1 SELECT NULL, md5(rand()) from t1 LIMIT 1000000;
INSERT INTO t1 SELECT NULL, md5(rand()) from t1 LIMIT 1000000;
INSERT INTO t1 SELECT NULL, md5(rand()) from t1 LIMIT 1000000;
INSERT INTO t1 values (NULL, 'foobar');
connection node_3;
connection node_1;
# node_1
SELECT * FROM t1 WHERE msg='foobar';
id	msg
524251	foobar
SELECT * FROM t1 WHERE msg='foobar';
id	msg
524251	foobar
connection node_2;
# node_2
SELECT * FROM t1 WHERE msg='foobar';
id	msg
524251	foobar
SELECT * FROM t1 WHERE msg='foobar';
id	msg
524251	foobar
connection node_3;
# node_3
SELECT * FROM t1 WHERE msg='foobar';
id	msg
524251	foobar
SELECT * FROM t1 WHERE msg='foobar';
id	msg
524251	foobar
connection node_4;
# node_4
SELECT * FROM t1 WHERE msg='foobar';
id	msg
524251	foobar
SELECT * FROM t1 WHERE msg='foobar';
id	msg
524251	foobar
connection node_1;
# node_1 insert new
INSERT INTO t1 values (5000000000, 'foobar');
connection node_3;
SELECT * FROM t1 WHERE msg='foobar';
id	msg
524251	foobar
5000000000	foobar
SELECT * FROM t1 WHERE msg='foobar';
id	msg
524251	foobar
5000000000	foobar
connection node_2;
# node_2
SELECT * FROM t1 WHERE msg='foobar';
id	msg
524251	foobar
5000000000	foobar
SELECT * FROM t1 WHERE msg='foobar';
id	msg
524251	foobar
5000000000	foobar
connection node_3;
# node_3
SELECT * FROM t1 WHERE msg='foobar';
id	msg
524251	foobar
5000000000	foobar
SELECT * FROM t1 WHERE msg='foobar';
id	msg
524251	foobar
5000000000	foobar
connection node_4;
# node_4
SELECT * FROM t1 WHERE msg='foobar';
id	msg
524251	foobar
5000000000	foobar
SELECT * FROM t1 WHERE msg='foobar';
id	msg
524251	foobar
5000000000	foobar
connection node_2;
# node_3 different query same table
SELECT id, msg FROM t1 WHERE msg='foobar';
id	msg
524251	foobar
5000000000	foobar
connection node_4;
# node_6 different query same table
SELECT id, msg FROM t1 WHERE msg='foobar';
id	msg
524251	foobar
5000000000	foobar
connection node_1;
drop table t1;
connection node_3;
connection node_3;
STOP SLAVE;
RESET SLAVE ALL;
connection node_1;
SET SESSION WSREP_ON=OFF;
RESET MASTER;
SET SESSION WSREP_ON=ON;
disconnect node_2;
disconnect node_1;
# End of test

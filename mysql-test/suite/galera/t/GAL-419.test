#
# GAL-419 safe_to_bootstrap: boostrap using wsrep_cluster_address=gcomm:// not prevented
#

--source include/galera_cluster.inc
--source include/big_test.inc

--connection node_1
SET SESSION wsrep_sync_wait = 0;
--source include/kill_galera.inc

--connection node_2
SET SESSION wsrep_sync_wait = 0;
--source include/kill_galera.inc

--sleep 2

# Node #1 has wsrep_cluster_address=gcomm:// in my.cnf, so should fail to bootstrap

--error 1
--exec $MYSQLD --defaults-group-suffix=.1 --defaults-file=$MYSQLTEST_VARDIR/my.cnf --log-error=$MYSQL_TMP_DIR/GAL-419.err
--disable_result_log
--exec grep 'It may not be safe to bootstrap the cluster from this node' $MYSQL_TMP_DIR/GAL-419.err >/dev/null
--enable_result_log
--remove_file $MYSQL_TMP_DIR/GAL-419.err

# Unless we remove grastate.dat

--remove_file $MYSQLTEST_VARDIR/mysqld.1/data/grastate.dat
--remove_file $MYSQLTEST_VARDIR/mysqld.2/data/grastate.dat

--connection node_1
--let $_expect_file_name= $MYSQLTEST_VARDIR/tmp/mysqld.1.expect
--source include/start_mysqld.inc
--source include/wait_until_connected_again.inc

--connection node_2
--let $_expect_file_name= $MYSQLTEST_VARDIR/tmp/mysqld.2.expect
--source include/start_mysqld.inc

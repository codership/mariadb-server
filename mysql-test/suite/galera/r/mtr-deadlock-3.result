connection node_2;
connection node_1;
connect node_1a, 127.0.0.1, root, , test, $NODE_MYPORT_1;
connect node_1b, 127.0.0.1, root, , test, $NODE_MYPORT_1;
connect node_1c, 127.0.0.1, root, , test, $NODE_MYPORT_1;
CREATE TABLE t1 (i int primary key, j int);
INSERT INTO t1 VALUES (1,0),(2,0),(3,0);
connection node_1a;
BEGIN;
UPDATE t1 SET j=11 WHERE i=1;
connection node_1b;
BEGIN;
UPDATE t1 SET j=22 WHERE i=2;
connection node_1c;
BEGIN;
UPDATE t1 SET j=33 WHERE i=3;
connection node_1a;
UPDATE t1 SET j=11 WHERE i=2;;
connection node_1b;
UPDATE t1 SET j=22 WHERE i=3;;
connection node_1c;
UPDATE t1 SET j=33 WHERE i=1;
ERROR 40001: Deadlock found when trying to get lock; try restarting transaction
connection node_1b;
COMMIT;
SELECT * FROM t1;
i	j
1	0
2	22
3	22
connection node_1a;
COMMIT;
SELECT * FROM t1;
i	j
1	11
2	11
3	22
connection node_1c;
SELECT * FROM t1;
i	j
1	11
2	11
3	22
DROP TABLE t1;
